\documentclass[12pt]{article}
\usepackage{ctable,microtype,natbib,amsmath,amssymb,fullpage,graphicx}
\usepackage[colorlinks,linkcolor=black,citecolor=blue,urlcolor=black]{hyperref}
\usepackage{setspace}
%\onehalfspacing
 
\title{Anchor Finding Interface V1.0}
\author{Yoni Halpern}
 
\begin{document}
 
\maketitle{}
 

Hi! This document accompanies the initial release of the anchor interface described in: ``Using Anchors to Estimate Clinical State without Labeled Data'' by Y. Halpern, Y.D. Choi, S. Horng, D. Sontag. To appear in the American Medical Informatics Association (AMIA) Annual Symposium, Nov. 2014. It is probably woefully incomplete, please direct questions/comments to Yoni Halpern: halpern@cs.nyu.edu. 

{\bf I'm happy to work with you to get this up and running on your dataset of interest!}



\section{Quick Start}

\subsection{Installation}
Pull the github repository for AnchorExplorer with the following command:

\begin{verbatim}
$ git clone ..
$ cd anchorExplorer
\end{verbatim}

We have tested the interface on a system with the following properties:
\begin{itemize}
\item Mac or unix OS
\item python 2.6 or 2.7
\item numpy 1.8.1 and scipy 0.13.3
\item scikit-learn 0.15
\item networkx 1.8.1
\item Tkinter Revision 81008
\item ttk 0.3.1
\end{itemize}

Required python packages are listed a file, requirements.txt and can be installed using pip:

\begin{verbatim}
$ pip install -r requirements.txt
\end{verbatim}

\subsection{Data}
To start, you need to have patient records in xml format. 
However, if you want to test that you can get things up and running with dummy data you can use the following command to generate 1000 properly formatted ``random'' patient records and store them in patients.xml.

\begin{verbatim}
$ python generate_patients.py 1000 > patients.xml
\end{verbatim}

A more realistic dataset can be created if you have access to the MIMIC-II clinical notes.

\begin{verbatim}
$ python generate_from_mimic.py 1000 > patients.xml
\end{verbatim}

\subsection{Settings}
An example settings file is provided in the examples/ directory. To customize this file for your own data, see section~\ref{sec:custom_settings}.

\subsection{Preprocess Data}

Use the preprocess\_patients.py script to preprocess the data in patients.xml for easy lookups and storage. The interface will read from the files generated by this script. Using the example settings file:

\begin{verbatim}
$ python preprocess_patients.py 1000 patients.xml examples/settings.xml
\end{verbatim}

This script does some simple negation detection, bigram detection and stopword removal.
If you wish to use your own custom language processing pipeline, see section~\ref{sec:language_processing}.

\subsection{Run the interface}
To run the interface using the example settings file:

\begin{verbatim}
$ python gui.py examples/settings.xml
\end{verbatim}

\subsection{Exploring the data}

\subsection{Learning a model}

\subsection{Customizing the settings.xml file}
\label{sec:custom_settings}
The settings.xml file makes it easy\footnote{maybe} to customize the interface for your particular dataset. An example settings.xml file is provided along with the interface code. Most of it can be left as is. The most important parts to customize are the {\tt dataTypes} and {\tt displaySettings} sections.

\subsubsection{patientSets}
This section describes which patients should be selected for visualization. If you have many patients, the interface may run slowly, here you can show that you only want to use the first 10,000 patients for an initial exploration.

\begin{verbatim}
1. <patientSets>
2.    <set name='train' start='0' end='10000'/>
3. </patientSets>
\end{verbatim}

The only important patientSet in this version of the code is the ``train'' set. The start and end fields indicate indices of patients as they are listed in the file visitIDs which is generated by the preprocessing script.


\subsubsection{dataTypes}
\label{sec:dataTypes}
We divide data into different {\em types} (e.g. text, age, sex, medications, diagnoses, procedures, etc.). Each type is denoted by a {\tt datum} tag and contains a number of {\tt field} tags that describe where this data appears in a patient xml representation.

For example, here is a sample patient representation in xml format:

\begin{verbatim}
//patient.xml
1. <visit>
2.    <index>qVwLYjLKqlkZhvkf</index>
3.    <MDcomments> SOME TEXT</MDcomments>
4.    <Age> 44 </Age>
5.    <Sex>M</Sex>
6.    <ChiefComplaint> SOME TEXT</ChiefComplaint>
7.    <Diagnosis>
8.        <D_name>HYPERTENSIVE RETINOPATHY</D_name>
9.        <D_code>362.11</D_code>
10.       <D1_name>CHILD/ADULT ABUSE BY SIBLING</D1_name>
11.       <D1_code>E967.5</D1_code>
12.    </Diagnosis>
13.    <TriageAssessment>SOME TEXT</TriageAssessment>
14. </visit>
\end{verbatim}
{\bf Important}: Every patient instance must be enclosed in a {\tt visit} tag and must have a unique {\tt index} tag. All other fields are customizable.

Here is a section of settings.xml that could be used for patient records with this schema.

\begin{verbatim}
//settings.xml
1. <datum type=`text' heirarchy=`' prefix=`'>
2.     <field name=`MDcomments' path=`.'/>
3.     <field name=`ChiefComplaint' path=`.'/>
4.     <field name=`TriageAssessment' path=`.'/>
5. </datum>
\end{verbatim}

Line 1 of settings.xml says that there is a type of data called {\bf text}. That it is not hierarchical and that it should not be represented with any special prefix.

Lines 2-4 show where in the patient records it can be found (ie. the MDcomments, ChiefComplaint and TriageAssessment sections). The final representation of the {\bf text} data will be a concatenation of these three fields.


\subsubsection{Display Settings}
\label{sec:display_settings}
For each type of data described in Section~\ref{sec:dataTypes}, you may want to customize where it is displayed (or whether it is displayed at all). Here you can specify what appears in the {\tt patientSummary} section and the {\tt detailedDisplay}. 

The following snippet says that Age, Sex and ChiefComplaint should be displayed as the patient summary:
\begin{verbatim}
<patientSummary>
    <displayFields>
        <field name='Age'/>
        <field name='Sex'/>
        <field name='ChiefComplaint'/>
    </displayFields>
</patientSummary>
\end{verbatim}

And the following snippet says that ChiefComplaint, TriageAssessment, MDcomments and Diagnosis should be displayed in the detailed patient description:

\begin{verbatim}
<detailedDisplay>
    <displayFields>
        <field name='ChiefComplaint' path='.'/>
        <field name='TriageAssessment' path='.'/>
        <field name='MDcomments' path='.'/>
        <field name='Diagnosis' path="."/>
    </displayFields>
</detailedDisplay>
\end{verbatim}

The resulting display is shown in Figure~\ref{patientDisplay}.
\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.5]{patientDisplayScreenshot}
	\end{center}
	\caption{\label{patientDisplay} Customizing the patient display as described in section~\ref{sec:display_settings}. The bottom list view shows Age, Sex and Chief Complaint for every patient. The top detailed view of a single patient shows fields: ChiefComplaint, TriageAssessment,MDcomments and Diagnosis. We display random words instead of real patient notes.}
	\label{fig:figure1}
\end{figure}

\section{Using the anchor interface}

\subsection{Starting the interface}

The following command starts the interface running:

\begin{verbatim}
$ python gui.py
\end{verbatim}

\subsection{Concept Selection Menu (Top Left)}
Allows you to select concepts, and create new ones.
Some commands:
\begin{itemize}
\item New concept button to create a new concept
\item `-' delete concept
\item `r' rename concept
\end{itemize}

\subsection{Anchor Display (Top Middle)}
Displays the current anchors for the selected topic.
Commands:
\begin{itemize}
\item Enter text into text box and push enter to add a new anchor
\item `-' delete selected anchor
\item Anchors can also be added using the anchor suggestion pane (Top Right)
\end{itemize}

\subsection{Anchor Suggestion Pane (Top Right)}
Displays suggestions for anchors and allows for navigation and adding of structured anchors.
Commands:
\begin{itemize}
\item ``+'' to add selected anchor suggestion
\item ``suggest'' pane gives ranked anchor suggestions.
\item other panes give an interface to navigate structured data types (e.g. code, med, etc)
\end{itemize}

\subsection{Learn Button}

Learns a model using the currently selected anchors.

\subsection{Detailed Patient Display (Middle Right)}
Detailed display of the patient selected in Patient List (Bottom Right). Anchors are highlighted red. Structured data types can be clicked to navigate directly to the relevant part of the hierarchy (displayed in Anchor Suggestion Pane).

\subsection{Patient List (Bottom Right)}
List of patients with summary information. 
These patients can be filtered using the radio buttons on the left (e.g. view all anchored, view not anchored, etc).
After the concept has been ``learned'' using the Learn Button, this list will be ranked in order of how highly the patient fits the currently selected concept.

Usage:
\begin{itemize}
\item arrow keys to navigate
\item ``+'' mark patient as a positive example
\item ``-'' mark patient as a negative example
\item ``0'' remove patient markings
\end{itemize}

\subsection{Structured data representations}
We provide a structured representation for ICD9 codes, but if you have other structured representations that you wish to use (NDC, LOINC, etc), you can provide structure files here. More details on this to come.


\section{More Information}
Contact: Yoni Halpern - halpern@cs.nyu.edu
\end{document}
